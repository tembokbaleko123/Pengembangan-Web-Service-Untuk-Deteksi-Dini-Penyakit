<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <title>Hasil Diagnosa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-dark custom-navbar px-4">
        <a class="navbar-brand fw-bold" href="#">
            <img src="/static/asset/img/pws.png" alt="StayHealthy" class="logo-img">
        </a>

        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto me-4 gap-4">
                <li class="nav-item">
                    <a class="nav-link active" href="{{ url_for('index' ) }}">Home</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="hero-strip"></div>

    <!-- CONTENT -->
    <div class="container my-5">
        <div class="row">
            <!-- KIRI -->
            <div class="col-md-7">
                <div class="card shadow p-4">
                    <h4 class="result-title mb-3 text-center">Hasil Diagnosa Cerebral Palsy</h4>
                    <div class="chart-wrapper d-flex justify-content-center">
                        <canvas id="cpChart"></canvas>
                    </div>
                    <hr>
                    <h5 class="mt-3">Persentase Tipe Cerebral Palsy</h5>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item">Spastic: <strong>45%</strong></li>
                        <li class="list-group-item">Dyskinetic: <strong>25%</strong></li>
                        <li class="list-group-item">Ataxia: <strong>20%</strong></li>
                        <li class="list-group-item">Mixed: <strong>10%</strong></li>
                    </ul>
                </div>
            </div>


            <!-- KANAN -->
            <div class="col-md-5">
                <div class="p-4 h-100">
                    <h5 class="result-title">Tentang Cerebral Palsy</h5>
                    <p>
                        Cerebral Palsy adalah gangguan perkembangan gerak dan postur tubuh yang disebabkan oleh
                        kerusakan pada otak yang terjadi sejak masa perkembangan awal.
                    </p>


                    <h6 class="mt-3">Saran</h6>
                    <p id="medicalAdvice">
                        Berdasarkan hasil diagnosa, disarankan untuk melakukan pemantauan lebih lanjut dan berkonsultasi
                        dengan tenaga medis apabila gejala semakin memburuk.
                    </p>


                    <div class="alert alert-warning mt-3" id="warningBox" style="display:none;">
                        <strong>Perhatian:</strong> Tingkat kemungkinan tinggi. Segera konsultasikan ke dokter spesialis
                        saraf atau rehabilitasi medik.
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    </div>

    <!-- FOOTER -->
    <footer class="footer text-center">
        <small>
            Copyright Â© 2026 StayHealthy. All rights reserved.<br>
            Terms of Use | Privacy Policy | Cookie Policy
        </small>
    </footer>

   <script>
    document.addEventListener("DOMContentLoaded", function () {
        // 1. Ambil data dari LocalStorage
        const storedData = localStorage.getItem('hasil_diagnosa');

        if (!storedData) {
            alert("Data diagnosa tidak ditemukan.");
            window.location.href = "/diagnosa";
            return;
        }

        const result = JSON.parse(storedData);
        console.log("Data Backend Diterima:", result); // Akan muncul {"P1":36, "P2":0, ...}

        // 2. Pemetaan Data (MENYESUAIKAN KEY P1, P2, P3, P4)
        const dataCP = {
            spastic: Math.round(result.P1 || 0),    // Mengambil dari "P1"
            dyskinetic: Math.round(result.P2 || 0), // Mengambil dari "P2"
            ataxia: Math.round(result.P3 || 0),     // Mengambil dari "P3"
            mixed: Math.round(result.P4 || 0)       // Mengambil dari "P4"
        };

        // 3. Update Angka di UI (List)
        // Pastikan ID ini ada di elemen <strong> Anda
        if(document.getElementById('valP01')) document.getElementById('valP01').innerText = dataCP.spastic + '%';
        if(document.getElementById('valP02')) document.getElementById('valP02').innerText = dataCP.dyskinetic + '%';
        if(document.getElementById('valP03')) document.getElementById('valP03').innerText = dataCP.ataxia + '%';
        if(document.getElementById('valP04')) document.getElementById('valP04').innerText = dataCP.mixed + '%';

        // Jika Anda menggunakan querySelector (cara alternatif):
        const listItems = document.querySelectorAll('.list-group-item strong');
        if(listItems.length >= 4) {
            listItems[0].innerText = dataCP.spastic + '%';
            listItems[1].innerText = dataCP.dyskinetic + '%';
            listItems[2].innerText = dataCP.ataxia + '%';
            listItems[3].innerText = dataCP.mixed + '%';
        }

        // 4. Update Grafik Chart.js
        const ctx = document.getElementById('cpChart');
        if (ctx) {
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Spastic', 'Dyskinetic', 'Ataxia', 'Mixed'],
                    datasets: [{
                        data: [dataCP.spastic, dataCP.dyskinetic, dataCP.ataxia, dataCP.mixed],
                        backgroundColor: ['#ff6fae', '#ff9fc9', '#ffc1dc', '#ffdbe9']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' },
                        datalabels: {
                            color: '#3b2b44',
                            font: { weight: 'bold', size: 14 },
                            formatter: (value) => value > 0 ? value + '%' : ''
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });
        }
    });
</script>

</body>

</html>