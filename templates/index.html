<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Sistem Pakar Cerebral Palsy</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="container">
    <h2>Sistem Pakar Diagnosis Cerebral Palsy</h2>
    <p>Pilih gejala dan tingkat keyakinan Anda</p>

    <form id="diagnosisForm">

    {% for g in gejala %}
    <div class="gejala">
        <label>
            <input type="checkbox" data-kode="{{ g.Kode }}">
            {{ g['Nama Gejala'] }}
        </label>

        <input type="range"
               min="0" max="1" step="0.1"
               value="0" disabled>

        <span class="nilai">0</span>
    </div>
    {% endfor %}

    <button type="submit">Proses Diagnosis</button>
</form>


    <div id="hasil" class="hasil"></div>
</div>

<script>
document.querySelectorAll('.gejala').forEach(item => {
    const checkbox = item.querySelector('input[type="checkbox"]');
    const slider = item.querySelector('input[type="range"]');
    const nilai = item.querySelector('.nilai');

    // Default aman
    slider.disabled = true;
    slider.value = 0;
    nilai.textContent = "0";

    checkbox.addEventListener('change', () => {
        if (checkbox.checked) {
            slider.disabled = false;
        } else {
            slider.disabled = true;
            slider.value = 0;
            nilai.textContent = "0";
        }
    });

    slider.addEventListener('input', () => {
        nilai.textContent = slider.value;
    });
});

document.getElementById("diagnosisForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    let data = {};

    document.querySelectorAll('.gejala').forEach(item => {
        const checkbox = item.querySelector('input[type="checkbox"]');
        const slider = item.querySelector('input[type="range"]');

        if (checkbox.checked && parseFloat(slider.value) > 0) {
            data[checkbox.dataset.kode] = parseFloat(slider.value);
        }
    });

    // Guard: tidak ada gejala dipilih
    if (Object.keys(data).length === 0) {
        alert("Silakan pilih minimal satu gejala.");
        return;
    }

    const response = await fetch("/diagnosis", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    });

    const result = await response.json();

    let output = "<h3>Hasil Diagnosis</h3>";
    for (let key in result) {
        output += `<p>${key}: <strong>${result[key]}%</strong></p>`;
    }

    document.getElementById("hasil").innerHTML = output;
});
</script>


</body>
</html>
